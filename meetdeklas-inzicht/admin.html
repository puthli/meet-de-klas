


<!DOCTYPE html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css" integrity="sha384-/Y6pD6FV/Vv2HJnA6t+vslU6fwYXjCFtcEpHbNJ0lyAFsXTsjBbfaDjzALeQsN6M" crossorigin="anonymous">
</head>
<meta charset="utf-8">
<meta http-equiv="refresh" content="120" />
<style type="text/css">
  h1 {
    text-align: center;
    margin: 30pt;
  }
  .row {
    margin: 10pt;
  }
  .col-3 {
    background-color: #EAEAEA;
    margin:5pt;
    padding: 5pt;
  }
</style>

<body>
  <div id="loader" style="position: fixed; left: 50%; top: 50%;">
    <img src="./ajax-loader.gif"></img>
  </div>

  <script src="https://d3js.org/d3.v4.min.js"></script>
  <script>

    function processData(data){
      console.debug(JSON.stringify(data));
      // strip off the outer elements to get at the data
      response = JSON.parse(data.responseText);
      for (element in response){
          name = response[element].id;
          co2 = response[element].co2.value;
          humidity = response[element].humidity.value;
          temperature = response[element].temperature.value;
          dateModified = response[element].dateModified.value;
          updateText(name, co2, temperature, humidity, dateModified);
      }

      // remove loader image
      loader = document.getElementById("loader");
      loader.style.display = "none";
    }


    function updateText(name, co2, temperature, humidity, dateModified){
      sensors = document.getElementById("sensors");
      div = document.createElement("div");
      div.onclick = function() {
        document.location.href = "index.html?sensor="+name+"&days=3";
      };
      div.className='col-3';
      div.innerHTML = " <h2>"
      + name + "</h2> <p>co2: "
      + co2 + "</p> <p>humidity: " + humidity
      + "</p> <p>temperature: " + temperature
      + "</p> <p>last change: " + dateModified + "</p>";
      sensors.appendChild(div);
    }

    function performRequest(url, callback){
      let request = d3.request(url);
      request.header("Fiware-Service", "meetdeklas");
      request.header("Fiware-Servicepath", "/");
      request.get(callback);
    }

    url = "https://api.meetdeklas.nl/orion/v2/entities?type=MeetDeKlasSensor&options=dateCreated,dateModified";

    performRequest(url, processData);

  </script>
  <H1> All running sensors
  </H1>
<div id = 'table' class='container-fluid'>
  <div id='sensors' class='row'>

  </div>

</div>
</div>

</body>
